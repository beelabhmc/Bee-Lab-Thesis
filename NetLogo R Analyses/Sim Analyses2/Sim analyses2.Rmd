---
title: "Simulation Analyses"
author: Sam Woodman
output: html_document
---

```{r}
library(dplyr)
# setwd("~/Google Drive/Semester 8/Thesis/NetLogo+R GitHub/NetLogo R Analyses/Sim Analyses2")

# Simulation data
all.data <- read.csv("Bees sim_all2-table.csv", skip = 6, stringsAsFactors=FALSE)

# Data cleanup
all.data$environment <- as.factor(sapply(1:nrow(all.data), 
                                         function(i) {i <- paste(substr(all.data$resource_density[i],2,2), ": ", 
                                                                 substr(all.data$R_value[i], 2,4), sep = "")}))
names(all.data)[5] <- "communication"
all.data$communication <- as.factor(all.data$communication)
all.data$population <- as.factor(all.data$population)
names(all.data)[11] <- "nectar.bee"
all.data$log.nectar.bee <- log(all.data$nectar.bee)

# Dense
dense.data <- all.data %>% filter(resource_density == "\"dense\"")
dense.data$environment <- as.factor(as.character(dense.data$environment))
dense.data.some <- dense.data %>% filter(environment == "d: 0.8" | 
                                           environment == "d: 1.0")
# Sparse
sparse.data <- all.data %>% filter(resource_density == "\"sparse\"")
sparse.data$environment <- as.factor(as.character(sparse.data$environment))
sparse.data.some <- sparse.data %>% filter(environment == "s: 0.8" | 
                                             environment == "s: 1.0")
```

## Plots
Here are the plot of the dense and sparse simulation runs

### Dense
```{r}
# Plot results
boxplot(nectar.bee ~ communication+population+environment, data=dense.data, ylab = "Nectar(mL)/bee", 
        xlab = "Parameters left to right: F_500, T_500, F_3000, T_3000", main = "Dense sims", 
        names = c("0.4", "0.4", "0.4", "0.4",
                  "0.6", "0.6", "0.6", "0.6",
                  "0.8", "0.8", "0.8", "0.8",
                  "1.0", "1.0", "1.0", "1.0"))

boxplot(log.nectar.bee ~ communication+population+environment, data=dense.data, ylab = "Log(Nectar(mL)/bee)", 
        xlab = "Parameters left to right: F_500, T_500, F_3000, T_3000", main = "Dense sims", 
        names = c("0.4", "0.4", "0.4", "0.4",
                  "0.6", "0.6", "0.6", "0.6",
                  "0.8", "0.8", "0.8", "0.8",
                  "1.0", "1.0", "1.0", "1.0"))

boxplot(nectar.bee ~ communication+population+environment, data=dense.data.some, ylab = "Nectar(mL)/bee", 
        xlab = "Parameters left to right: F_500, T_500, F_3000, T_3000", main = "Some dense sims", 
        names = c("", "", "", "", 
                  "", "", "", "", 
                  "0.8", "0.8", "0.8", "0.8",
                  "1.0", "1.0", "1.0", "1.0"))

```


### Sparse

```{r}
# Plot results
boxplot(nectar.bee ~ communication+population+environment, data=sparse.data, ylab = "Nectar(mL)/bee", 
        xlab = "Parameters left to right: F_500, T_500, F_3000, T_3000", 
        names = c("0.4", "0.4", "0.4", "0.4",
                  "0.6", "0.6", "0.6", "0.6",
                  "0.8", "0.8", "0.8", "0.8",
                  "1.0", "1.0", "1.0", "1.0"))

boxplot(log.nectar.bee ~ communication+population+environment, data=sparse.data, ylab = "Log(Nectar(mL)/bee)", 
        xlab = "Parameters left to right: F_500, T_500, F_3000, T_3000", main = "Sparse sims", 
        names = c("0.4", "0.4", "0.4", "0.4",
                  "0.6", "0.6", "0.6", "0.6",
                  "0.8", "0.8", "0.8", "0.8",
                  "1.0", "1.0", "1.0", "1.0"))

boxplot(nectar.bee ~ communication+population+environment, data=sparse.data.some, ylab = "Nectar(mL)/bee", 
        xlab = "Parameters left to right: F_500, T_500, F_3000, T_3000", main = "Sparse sims", 
        names = c("", "", "", "", 
                  "", "", "", "", 
                  "0.8", "0.8", "0.8", "0.8",
                  "1.0", "1.0", "1.0", "1.0"))
```


## Data Analyses-ANOVAs

Now for the actual data analysis. We will perform anova tests to test for first significant pairwise interactions between colony size, communication, and environment and then for all factors (wording-fix).

### 1. Testing for an interaction effect between colony size and communication
```{r}
null <- lm(nectar.bee ~ population+communication+environment, data = all.data)
alt.1a <- lm(nectar.bee ~ population*communication+environment, data = all.data)
anova(null, alt.1a)
```

### 2. Testing for an interaction effect between colony size and environment
```{r}
alt.1b <- lm(nectar.bee ~ population*environment+communication, data = all.data)
anova(null, alt.1b)
```

### 3. Testing for an interaction effect between communication and environment
```{r}
alt.1c <- lm(nectar.bee ~ population+communication*environment, data = all.data)
anova(null, alt.1c)
```

### 4. Testing for an interaction effect between colony size, communication, and environment
```{r}
null.all.1 <- lm(nectar.bee ~ population + communication + environment + 
                   population*communication + population*environment + communication*environment, data = all.data)
alt.all.1 <- lm(nectar.bee ~ population*communication*environment, data = all.data)
anova(null.all.1, alt.all.1)
```


## Other
### Found vs Untouched
```{r}
# found.all
null.2 <- glm(cbind(resources.found, resources.untouched) ~ population+communication+environment, family = binomial(), data = all.data)
alt.2a <- glm(cbind(resources.found, resources.untouched) ~ population*communication+environment, family = binomial(), data = all.data)
alt.2b <- glm(cbind(resources.found, resources.untouched) ~ population+communication*environment, family = binomial(), data = all.data)
alt.2c <- glm(cbind(resources.found, resources.untouched) ~ population*environment+communication, family = binomial(), data = all.data)

anova(null.2, alt.2a, test="Chisq")
anova(null.2, alt.2b, test="Chisq")
anova(null.2, alt.2c, test="Chisq")
```

```{r}
null.all.2 <- glm(cbind(resources.found, resources.untouched) ~ population + communication + environment + 
                    population*communication + population*environment + communication*environment, family = binomial(), data = all.data)
alt.all.2 <- glm(cbind(resources.found, resources.untouched) ~ population*environment*communication, family = binomial(), data = all.data)
anova(null.all.2, alt.all.2, test="Chisq")
```

### Depleted vs Found and not depleted
```{r}
# found.all
null.3 <- glm(cbind(resources.depleted, (resources.found-resources.depleted)) ~ population+communication+environment, family = binomial(), data = all.data)
alt.3a <- glm(cbind(resources.depleted, (resources.found-resources.depleted)) ~ population*communication+environment, family = binomial(), data = all.data)
alt.3b <- glm(cbind(resources.depleted, (resources.found-resources.depleted)) ~ population+communication*environment, family = binomial(), data = all.data)
alt.3c <- glm(cbind(resources.depleted, (resources.found-resources.depleted)) ~ population*environment+communication, family = binomial(), data = all.data)

anova(null.3, alt.3a, test="Chisq")
anova(null.3, alt.3b, test="Chisq")
anova(null.3, alt.3c, test="Chisq")
```

```{r}
null.all.3 <- glm(cbind(resources.depleted, (resources.found-resources.depleted)) ~ population + communication + environment + 
                    population*communication + population*environment + communication*environment, family = binomial(), data = all.data)
alt.all.3 <- glm(cbind(resources.depleted, (resources.found-resources.depleted)) ~ population*environment*communication, family = binomial(), data = all.data)
anova(null.all.3, alt.all.3, test="Chisq")
```

